<!DOCTYPE html>
<html xmlns:wicket="http://wicket.apache.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title wicket:id="appTitle">Certidões</title>

    <!-- Bootstrap (pra ficar com cara de sistema sem sofrer) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <span class="navbar-brand mb-0 h1" wicket:id="appName">Certidões</span>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a wicket:id="linkHome" class="nav-link">Home</a>
            </li>
            <li class="nav-item">
                <a wicket:id="linkListar" class="nav-link">Listar Certidões</a>
            </li>
            <li class="nav-item">
                <a wicket:id="linkNova" class="nav-link">Nova Certidão</a>
            </li>
            <li class="nav-item">
                <a wicket:id="linkComponentes" class="nav-link">Componentes Wicket</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container mt-4">
    <div wicket:id="feedback"></div>
    <wicket:child/>
</div>

<!-- Bootstrap JS (para o menu mobile funcionar) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Modal de Confirmação (reutilizável para ConfirmacaoBehavior) -->
<div class="modal fade" id="modalConfirmacao" tabindex="-1" role="dialog" aria-labelledby="modalConfirmacaoLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalConfirmacaoLabel">Confirmação</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modalConfirmacaoMensagem">
                <!-- Mensagem será inserida aqui via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="modalConfirmacaoBtnConfirmar">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript para controlar o modal de confirmação -->
<script>
    // Função para abrir modal de confirmação
    // Usada pelo ConfirmacaoBehavior para exibir confirmações via Modal Bootstrap
    function abrirModalConfirmacao(mensagem, callbackConfirmar) {
        // Atualizar mensagem do modal
        document.getElementById('modalConfirmacaoMensagem').textContent = mensagem;
        
        // Remover listeners anteriores para evitar múltiplos handlers
        var btnConfirmar = document.getElementById('modalConfirmacaoBtnConfirmar');
        var novoBtn = btnConfirmar.cloneNode(true);
        btnConfirmar.parentNode.replaceChild(novoBtn, btnConfirmar);
        
        // Adicionar listener ao botão confirmar
        novoBtn.addEventListener('click', function() {
            // Fechar modal
            $('#modalConfirmacao').modal('hide');
            // Executar callback de confirmação após o modal fechar
            setTimeout(function() {
                if (callbackConfirmar) {
                    callbackConfirmar();
                }
            }, 300); // Pequeno delay para garantir que o modal fechou
        });
        
        // Abrir modal
        $('#modalConfirmacao').modal('show');
    }
    
    // Interceptar cliques em links com confirmação (fallback para Links do Wicket)
    // Isso garante que mesmo se o onclick não funcionar, ainda temos uma camada de proteção
    $(document).ready(function() {
        // Usar captura de evento (true) para interceptar antes do Wicket processar
        document.addEventListener('click', function(e) {
            var elemento = e.target;
            // Verificar se é um link ou botão com a classe de confirmação
            while (elemento && elemento !== document) {
                if (elemento.classList && elemento.classList.contains('wicket-confirmacao')) {
                    var mensagem = elemento.getAttribute('data-confirmacao-mensagem');
                    if (mensagem) {
                        // Verificar se já foi confirmado (flag para evitar loop)
                        if (elemento.dataset.confirmado === 'true') {
                            elemento.dataset.confirmado = 'false';
                            return true; // Deixa o Wicket processar
                        }
                        
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        var elementoLink = elemento;
                        var callbackConfirmar = function() {
                            // Marcar como confirmado
                            elementoLink.dataset.confirmado = 'true';
                            // Fazer o link clicar programaticamente
                            // Isso vai fazer o Wicket processar corretamente
                            var clickEvent = new MouseEvent('click', {
                                view: window,
                                bubbles: true,
                                cancelable: true,
                                buttons: 1
                            });
                            elementoLink.dispatchEvent(clickEvent);
                        };
                        abrirModalConfirmacao(mensagem, callbackConfirmar);
                        return false;
                    }
                }
                elemento = elemento.parentElement;
            }
        }, true); // true = usar captura (antes da fase de bubbling)
    });
</script>
</body>
</html>